(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-27309b2b"],{"83db":function(e,t,r){"use strict";var a=r("f5b8"),o=r.n(a);o.a},ca0f:function(e,t,r){},f255:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"device-manage"},[r("el-card",{staticClass:"base-card"},[r("div",{staticClass:"base-header",attrs:{slot:"header"},slot:"header"},[r("span",[e._v("设备信息")])]),r("el-button",{staticClass:"add-device-button",attrs:{type:"text"},on:{click:function(t){e.addDeviceDrawer=!0}}},[r("i",{staticClass:"el-icon-circle-plus-outline"}),e._v(" 添加设备 ")]),r("el-table",{staticStyle:{width:"780px"},attrs:{data:e.school.devices,stripe:"",border:"","header-row-class-name":function(){return"device-table-header"}}},[r("el-table-column",{attrs:{fixed:"","show-overflow-tooltip":"",label:"名称",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isEdit?r("el-input",{attrs:{placeholder:"请输入名称"},model:{value:t.row.name,callback:function(r){e.$set(t.row,"name",r)},expression:"scope.row.name"}}):r("p",[e._v(e._s(t.row.name))])]}}])}),r("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"类型",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isEdit?r("el-select",{attrs:{placeholder:"请选择类型"},model:{value:t.row.type,callback:function(r){e.$set(t.row,"type",r)},expression:"scope.row.type"}},e._l(e.deviceTypeOptions,(function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1):r("p",[e._v(e._s(e.deviceTypeOptions.find((function(e){return e.value===t.row.type})).label))])]}}])}),r("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"编号",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isEdit?r("el-input",{attrs:{placeholder:"请输入编号"},model:{value:t.row.device_number,callback:function(r){e.$set(t.row,"device_number",r)},expression:"scope.row.device_number"}}):r("p",[e._v(e._s(t.row.device_number))])]}}])}),r("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"型号",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isEdit?r("el-input",{attrs:{placeholder:"请输入型号"},model:{value:t.row.device_model,callback:function(r){e.$set(t.row,"device_model",r)},expression:"scope.row.device_model"}}):r("p",[e._v(e._s(t.row.device_model))])]}}])}),r("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"生产日期",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isEdit?r("el-date-picker",{attrs:{type:"date",placeholder:"选择日期",format:"yyyy/M/dd","value-format":"timestamp"},model:{value:t.row.product_time,callback:function(r){e.$set(t.row,"product_time",r)},expression:"scope.row.product_time"}}):r("p",[e._v(e._s(e._f("formatterDate")(t.row.product_time)))])]}}])}),r("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"安装时间",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isEdit?r("el-date-picker",{attrs:{type:"date",placeholder:"选择日期",format:"yyyy/M/dd","value-format":"timestamp"},model:{value:t.row.start_time,callback:function(r){e.$set(t.row,"start_time",r)},expression:"scope.row.start_time"}}):r("p",[e._v(e._s(e._f("formatterDate")(t.row.start_time)))])]}}])}),r("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"预计报废时间",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isEdit?r("el-date-picker",{attrs:{type:"date",placeholder:"选择日期",format:"yyyy/M/dd","value-format":"timestamp"},model:{value:t.row.end_time,callback:function(r){e.$set(t.row,"end_time",r)},expression:"scope.row.end_time"}}):r("p",[e._v(e._s(e._f("formatterDate")(t.row.end_time)))])]}}])}),r("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"设备状态",width:"100",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isEdit?r("el-select",{attrs:{placeholder:"请选择状态"},model:{value:t.row.device_status,callback:function(r){e.$set(t.row,"device_status",r)},expression:"scope.row.device_status"}},e._l(e.deviceStatusOptions,(function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1):r("p",[e._v(e._s(e.deviceStatusOptions.find((function(e){return e.value===t.row.device_status})).label))])]}}])}),r("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"编辑",width:"100",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isEdit?r("el-button",{attrs:{type:"text",size:"small"},on:{click:function(r){return e.saveSchoolDevice(t.row)}}},[e._v("保存")]):r("el-button",{attrs:{type:"text",size:"small"},on:{click:function(e){t.row.isEdit=!0}}},[e._v("编辑")])]}}])}),r("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"报修",width:"100",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{disabled:0!==t.row.device_status,type:"text",size:"small"},on:{click:function(r){return e.applyRepair(t.row.ID)}}},[e._v("报修")])]}}])})],1)],1),r("el-drawer",{attrs:{"with-header":!1,visible:e.addDeviceDrawer,direction:"rtl"},on:{"update:visible":function(t){e.addDeviceDrawer=t}}},[r("div",{staticClass:"add-school-drawer"},[r("el-form",{ref:"addDevices",attrs:{model:e.addDeviceFrom,rules:e.rules}},[r("el-form-item",{attrs:{label:"名称：",prop:"name"}},[r("el-input",{attrs:{placeholder:"请输入名称"},model:{value:e.addDeviceFrom.name,callback:function(t){e.$set(e.addDeviceFrom,"name",t)},expression:"addDeviceFrom.name"}})],1),r("el-form-item",{attrs:{label:"编号：",prop:"device_number"}},[r("el-input",{attrs:{placeholder:"请输入编号"},model:{value:e.addDeviceFrom.device_number,callback:function(t){e.$set(e.addDeviceFrom,"device_number",t)},expression:"addDeviceFrom.device_number"}})],1),r("el-form-item",{attrs:{label:"型号：",prop:"device_model"}},[r("el-input",{attrs:{placeholder:"请输入型号"},model:{value:e.addDeviceFrom.device_model,callback:function(t){e.$set(e.addDeviceFrom,"device_model",t)},expression:"addDeviceFrom.device_model"}})],1),r("el-form-item",{attrs:{label:"类型：",prop:"type"}},[r("el-select",{attrs:{placeholder:"请选择类型"},model:{value:e.addDeviceFrom.type,callback:function(t){e.$set(e.addDeviceFrom,"type",t)},expression:"addDeviceFrom.type"}},e._l(e.deviceTypeOptions,(function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),r("el-form-item",{attrs:{label:"生产时间：",prop:"product_time"}},[r("el-date-picker",{attrs:{type:"date",placeholder:"选择日期",format:"yyyy/M/dd","value-format":"timestamp"},model:{value:e.addDeviceFrom.product_time,callback:function(t){e.$set(e.addDeviceFrom,"product_time",t)},expression:"addDeviceFrom.product_time"}})],1),r("el-form-item",{attrs:{label:"安装时间：",prop:"start_time"}},[r("el-date-picker",{attrs:{type:"date",placeholder:"选择日期",format:"yyyy/M/dd","value-format":"timestamp"},model:{value:e.addDeviceFrom.start_time,callback:function(t){e.$set(e.addDeviceFrom,"start_time",t)},expression:"addDeviceFrom.start_time"}})],1),r("el-form-item",{attrs:{label:"预计报废时间：",prop:"end_time"}},[r("el-date-picker",{attrs:{type:"date",placeholder:"选择日期",format:"yyyy/M/dd","value-format":"timestamp"},model:{value:e.addDeviceFrom.end_time,callback:function(t){e.$set(e.addDeviceFrom,"end_time",t)},expression:"addDeviceFrom.end_time"}})],1),r("el-form-item",{attrs:{label:"设备状态",prop:"device_status"}},[r("el-select",{attrs:{placeholder:"请选择状态"},model:{value:e.addDeviceFrom.device_status,callback:function(t){e.$set(e.addDeviceFrom,"device_status",t)},expression:"addDeviceFrom.device_status"}},e._l(e.deviceStatusOptions,(function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),r("div",{staticClass:"demo-drawer__footer"},[r("el-button",{on:{click:function(t){e.addDeviceDrawer=!1}}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary",loading:e.addDeviceLoading},on:{click:e.addDevice}},[e._v(e._s(e.addDeviceLoading?"提交中 ...":"确 定"))])],1)],1)])],1)},o=[],n=(r("4178"),r("86dd"),r("33c4"),r("af82"),r("1a8c"),r("c354"),r("3f36"),r("f4dd"),r("79dd"),r("3a20"),r("7267"),r("9a14"),r("289c")),i=r("5a3e"),c=(r("63ff"),r("57f0")),s=r("ef5c"),l=r("6144"),d=r("94e6"),u=r.n(d);function p(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?p(Object(r),!0).forEach((function(t){Object(n["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):p(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var v={name:"SchoolInfo",data:function(){return{school:{},addDeviceDrawer:!1,addDeviceLoading:!1,addDeviceFrom:{name:"",device_number:null,device_model:null,type:1,product_time:Date.now(),start_time:Date.now(),end_time:Date.now(),school:null,device_status:0},rules:{name:[{required:!0,message:"请输入名称",trigger:"change"}],type:[{required:!0,message:"请选择类型",trigger:"change"}],location:[{required:!0,message:"请输入地址",trigger:"change"}],tel:[{required:!0,message:"请输入电话",trigger:"change"}],account:[{required:!0,message:"请输入账号",trigger:"change"}],passwords:[{required:!0,message:"请输入密码",trigger:"change"}],device_status:[{required:!0,message:"请输选择状态",trigger:"change"}]},schoolTypeOptions:[{value:1,label:"教学点"},{value:2,label:"中心校"}],deviceStatusOptions:[{value:0,label:"正常"},{value:1,label:"待维修"},{value:2,label:"报废"}],deviceTypeOptions:[{value:1,label:"屏幕"},{value:2,label:"摄像头"},{value:3,label:"话筒"},{value:4,label:"多媒体计算机"}]}},created:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,s["a"][l["d"]].getSchool().then((function(e){var t=Object(i["a"])(e,1),r=t[0];return m({},r,{isEdit:!1,devices:r.devices.map((function(e){return m({},e,{isEdit:!1})}))})}));case 2:e.school=t.sent;case 3:case"end":return t.stop()}}),t)})))()},methods:{mapSchool:function(e){return e.isEdit=!1,e.devices&&(e.devices=e.devices.map((function(e){return e.isEdit=!1,e}))),e},saveSchoolBaseInfo:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$refs[e.school.ID].validate(function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(r){var a,o,n,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!r){t.next=12;break}return t.next=3,s["a"][l["d"]].saveSchool(e.school).catch((function(t){return e.$message.error(t.toString())}));case 3:a=t.sent,o=Object(i["a"])(a,1),n=o[0],c=e.school.devices,console.log(e.mapSchool),e.school=m({},e.mapSchool(n),{devices:c}),e.$message.success("更新成功"),t.next=13;break;case 12:e.$message.error("请填写相关基本信息");case 13:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 1:case"end":return t.stop()}}),t)})))()},saveSchoolDevice:function(e){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function r(){var a,o,n,c;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(u()(e.name)||u()(e.device_status)){r.next=11;break}return r.next=3,s["a"][l["d"]].saveDevice(e).catch((function(e){return t.$message.error(e.toString())}));case 3:a=r.sent,o=Object(i["a"])(a,1),n=o[0],c=t.school.devices.findIndex((function(e){return e.ID===n.ID})),t.$set(t.school.devices,c,m({},n,{isEdit:!1})),t.$message.success("更新成功"),r.next=12;break;case 11:t.$message.error("请填写相关设备信息");case 12:case"end":return r.stop()}}),r)})))()},addDevice:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.addDeviceLoading=!0,e.$refs["addDevices"].validate(function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(r){var a,o,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!r){t.next=11;break}return t.next=3,s["a"][l["d"]].addDevice(m({},e.addDeviceFrom,{school:e.school.ID})).catch((function(t){return e.$message.error(t.toString())}));case 3:a=t.sent,o=Object(i["a"])(a,1),n=o[0],e.school.devices.push(m({},n,{isEdit:!1})),e.addDeviceDrawer=!1,e.$message.success("添加成功"),t.next=12;break;case 11:e.$message.error("请填写相关基本信息");case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),e.addDeviceLoading=!1;case 3:case"end":return t.stop()}}),t)})))()},applyRepair:function(e){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function r(){var a,o,n,c,d,u;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$prompt("描述设备问题","申请报修",{confirmButtonText:"确定",cancelButtonText:"取消",inputType:"textarea"}).catch((function(){return t.$message.info("取消输入")}));case 2:if(a=r.sent,o=a.value,!o){r.next=18;break}return r.next=7,s["a"][l["d"]].applyRepair({device:e,comment:o});case 7:if(n=r.sent,!n){r.next=17;break}return r.next=11,s["a"][l["d"]].changeDevicestatus({ID:e,device_status:1});case 11:c=r.sent,d=Object(i["a"])(c,1),u=d[0],t.$set(t.school.devices,t.school.devices.findIndex((function(t){return t.ID===e})),u),r.next=18;break;case 17:t.$message({type:"info",message:"提交报修记录失败"});case 18:case"end":return r.stop()}}),r)})))()}}},f=v,b=(r("fe24"),r("83db"),r("5511")),w=Object(b["a"])(f,a,o,!1,null,"4d12b1bc",null);t["default"]=w.exports},f5b8:function(e,t,r){},fe24:function(e,t,r){"use strict";var a=r("ca0f"),o=r.n(a);o.a}}]);
//# sourceMappingURL=chunk-27309b2b.f9e8df9f.js.map